#!/usr/bin/ruby
# encoding: utf-8

require 'optparse'
require_relative '../lib/drctrl/client'

command = nil
verbose = false

options = {
  uri: nil,
  path: nil,
  name: nil,
  pid: nil
}

opts = OptionParser.new do |o|

  o.on '-h', '-?', '--help', 'Show this help and exit.' do
    puts opts.help
    exit
  end

  o.on '-V', '--version', 'Show version info and exit' do
    puts DRCtrl::VERSION.join('.')
    exit
  end

  o.on '-v', '--[no-]verbose', 'Verbose mode.' do |value|
    verbose = value
  end

  o.separator ''

  o.on '-c', '--command', '=COMMAND', String do |value|
    command = value
  end

  o.separator ''

  o.on '-U', '--uri', '=URI', String do |value|
    options[:uri] = value
  end

  o.on '-P', '--path', '=PATH', String do |value|
    options[:path] = value
  end

  o.on '-N', '--name', '=NAME', String do |value|
    options[:name] = value
  end

  o.on '-I', '--pid', '=PID', Integer do |value|
    options[:pid] = value
  end

end

opts.parse ARGV

obj = DRCtrl.connect options

if Array === obj
  obj.each { |o| o.send command.intern }
else
  obj.send command.intern
end
